<script type="text/javascript">
	RED.nodes.registerType('component_in', {
		category: 'advanced',
		color: '#AA8888',
		defaults: {
      name: {value: "component in"},
		},
		label: function() {
			return this.name || "comp start";
		},
		inputs:0,
		outputs:1,
		icon: "inject.svg",
		paletteLabel: "comp start"
	});
</script>
<script type="text/x-red" data-template-name="component_in">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/javascript">
	RED.nodes.registerType('component', {
		category: 'advanced',
		color: '#AA8888',
		label: function() {
			return this.name || "run component";
		},
		defaults: {
      name: {value: "run component"},
			selected: {value: ""},
		},
		inputs:1,
		outputs:1,
		icon: "font-awesome/fa-retweet",
    paletteLabel: "use comp",
		oneditprepare: function() {
			this.editor = RED.editor.createEditor({
					id: 'node-description-editor',
					mode: 'ace/mode/markdown',
					value: $("#node-input-info").val()
			});

			let config = this;

			RED.nodes.eachNode(function(node) {
				// console.log("node", node);
				if (node.type == "component_in") {
					let option = '<option value="' + node.id + '"';
					option += (node.id == config.selected) ? ' selected="true"' : "";
					option += '>' + node.name + '</option>';
					$("#node-input-selected").append(option);
				}
			});
			$("#node-input-selected").val(config.selected);
		},
		oneditsave: function() {
			var node = this;
			$("#node-input-info").val(this.editor.getValue());
			node.selected = $("#node-input-selected").children("option:selected"). val();
      this.editor.destroy();
      delete node.editor;
		},
		oneditcancel: function() {
			this.editor.destroy();
			delete this.editor;
		}
	});
</script>

<script type="text/x-red" data-template-name="component">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
      <label for="node-input-selected"><i class="fa fa-random"></i> <span>Component</span></label>
			<select id="node-input-selected"></select>
    </div>
</script>

<script type="text/javascript">
	RED.nodes.registerType('component_out', {
		category: 'advanced',
		color: '#AA8888',
		label: function() {
			return this.name || "comp return";
		},
    align: 'right',
		defaults: {
      name: {value:"comp return"},
      links: { value: [] }
		},
		inputs:1,
		outputs:0,
		icon: "font-awesome/fa-mail-reply",
    paletteLabel: "comp return"
	});
</script>
